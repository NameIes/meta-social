{% extends 'profile/base.html' %}
{% load static %}
{% load cropping %}

{% block content %}
  <div class="row text-left">
    <div class="col-xl-3">
      <div class="card">
        <style>
          .rollover {
            transition: 0.3s;
          }
          .rollover:hover {
            transition: 0.7s;
            opacity: 0.7;
          }
        </style>
        {% if user == c_user %}
          <a href="/accounts/profile/{{ c_user.id }}/change_avatar/">
            <img src="{% cropped_thumbnail c_user.profile "cropping" %}" class="card-img-top rollover"></img>
          </a>
        {% else %}
          <img src="{% cropped_thumbnail c_user.profile "cropping" %}" class="card-img-top"></img>
        {% endif %}
        <div class="card-body">
          {% if c_user == user %}
            <hr class="mt-0">
            <a href="/accounts/profile/{{ c_user.id }}/edit_profile/" class="btn btn-block btn-primary">Редактировать</a>
          {% else %}
              <hr class="mt-0">
              {% if pass_add_to_friends %}
              <form method="POST" action="/friends/send_request/{{ c_user.id }}/">
                {% csrf_token %}
                <input class="btn btn-block btn-primary" type="submit" value="Добавить в друзья">
            </form>
          {% endif %}
        {% endif %}
        </div>
      </div>
      <div class="card mt-3">
        <div class="card-body">
          <h6 class="card-title">Друзья</h6>
        </div>
      </div>
      <div class="card mt-3 mb-3">
        <div class="card-body">
          <h6 class="card-title">Сообщества</h6>
        </div>
      </div>
    </div>
    <div class="col">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title float-left">{% if c_user.first_name or c_user.last_name %}{{ c_user.first_name }} {{ c_user.last_name }}{% else %}{{ c_user.username }}{% endif %}</h5>
          <small class="float-right text-muted">{% if is_online %}Онлайн{% else %}Оффлайн{% endif %}</small>
          <br><hr>
          <p class="card-text">{{ c_user.profile.get_gender_display }}</p>
          <p class="card-text">
            {% if c_user.profile.job %}
                {{ c_user.profile.job }}
            {% else %}
                Место работы/учебы не указано
            {% endif %}
          </p>
          <p class="card-text">
            {% if c_user.profile.biography %}
                {{ c_user.profile.biography }}
            {% else %}
                Биография не указана
            {% endif %}
          </p>
          <p class="card-text">
            {% if c_user.profile.country %}
                {{ c_user.profile.country.name }}
            {% else %}
                Страна не указана
            {% endif %}
          </p>
          <p class="card-text">
            {% if c_user.profile.birth %}
                {{ c_user.profile.birth }}
            {% else %}
                Дата рождения не указана
            {% endif %}
          </p>
          {% if c_user.profile.show_email %}
            <p class="card-text">
              {% if c_user.email %}
                {{ c_user.email }}
              {% else %}
                Почта не указана
              {% endif %}
            </p>
          {% endif %}
        </div>
      </div>

      {% if c_user == user %}
        <div class="card mt-3">
          <div class="card-body">
            {% include 'post_menu.html' %}
          </div>
        </div>
      {% endif %}

      {% if c_user.profile.posts %}
        {% for post in c_user.profile.posts %}
          <div class="card mt-3">
            <div class="card-body">
              <img src="{% cropped_thumbnail post.user.profile "cropping" %}" class="rounded-circle border border-dark" width=35 height=35>
              <a href="/accounts/profile/{{ post.user.id }}/">{{ post.user.username }}</a>
              <p class="card-text mt-2">{{ post.text }}</p>

              {% if post.get_images %}
                {% for post_img in post.get_images %}
                  <img src="{{ post_img.image.url }}" width="100%" class="mb-1">
                {% endfor %}
              {% endif %}

              <hr class="mt-1 mb-1">
              <span class="text-muted mb-0 float-right">{{ post.date }}</span>

              {% if post in user.profile.liked_posts.all %}
                <button class="btn btn-danger px-1 py-0" onclick="likePost(event, '{{ post.id }}')">{{ post.likes.count }} &#9829;</button>
              {% else %}
                <button class="btn btn-outline-danger px-1 py-0" onclick="likePost(event, '{{ post.id }}')">{{ post.likes.count }} &#9829;</button>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      {% else %}
        <h5 class="mt-3 text-center">Нет постов.</h5>
      {% endif %}
    </div>
  </div>
{% endblock %}

{% block extra__js %}
  <script src="{% static 'js/like_post.js' %}"></script>
{% endblock extra__js %}